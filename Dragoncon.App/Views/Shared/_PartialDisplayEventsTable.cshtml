@using System.Globalization
@using DragonCon.Features.Shared
@using DragonCon.Modeling.Helpers
@model DragonCon.Features.Shared.DisplayEventsViewModel
@{
    var isSelectable = false;
    List<string> selectedMap = new List<string>();

    if (Model is DisplaySelectableEventsViewModel selectable)
    {
        isSelectable = true;
        selectedMap = selectable.EventIdsSelected;
    }
}
<table class="table table-events" style="line-height: 1.75">
    @foreach (var approved in Model.Events.OrderBy(x => x.TimeSlot.From))
    {
        if (approved == null)
        {
            continue;
        }

        <tr class="event-row-filter" 
            data-event="@approved.Id.GetNumberFromId()"
            data-day="@approved.Day?.Id,@approved.TimeSlot?.From.ToString("H:mm", CultureInfo.InvariantCulture)"
            data-activity="@approved.Activity?.Id,@approved.SubActivity?.Id">
            <th colspan="100%"></th>
        </tr>
        <tr class="top-row event-row event-row-@approved.Id.GetNumberFromId()" style="font-size: 1.5em;">
            <td colspan="3" class="text-right text-middle tw-10">
                <span class="pull-left text-left">
                    @if (approved.Activity != null)
                    {
                        <span class="badge badge-dragon badge-offset-left text-bold">
                            <i class="fa fa-fw fa-dice-d6" data-toggle="tooltip" title="סוג הפעילות"></i>
                            @approved.Activity.Name
                        </span>
                    }

                    @if (approved.SubActivity != null)
                    {
                        <br />
                        <span class="badge badge-dragon badge-offset-left">
                            <i class="fa fa-fw fa-dice-d6" data-toggle="tooltip" title="סוג פעילות משנה"></i>
                            @approved.SubActivity.Name
                        </span>
                    }

                </span>
                @if (isSelectable)
                {
                    <span class="checkboxes-container">
                        <div class="checkboxes">
                            <div class="check">
                                <input id="event-check-@approved.Id.GetNumberFromId()" type="checkbox" onChange="checkbox('@approved.Id.GetNumberFromId()')" />
                                <label for="event-check-@approved.Id.GetNumberFromId()">
                                    <div class="box"><i class="fa fa-check"></i></div>
                                </label>
                            </div>
                        </div>
                    </span>
                }
                @{
                    var moneyBadgeClass = isSelectable ? "" : "badge-offset-right";
                }
                @if (approved.IsFree)
                {
                    <span class="badge badge-dragon @moneyBadgeClass" data-toggle="tooltip" title="אירוע זה לא נספר במכסת האירוע של הכרטיס"><i class="fa fa-fw fa-shekel-sign"></i> אירוע חופשי</span>
                    <br />
                }
                @if (approved.ExtraCharge > 0)
                {
                    <span class="badge badge-dragon @moneyBadgeClass" data-toggle="tooltip" title="אירוע זה בתשלום נוסף"><i class="fa fa-fw fa-shekel-sign"></i> אירוע בתשלום נוסף - @approved.ExtraCharge ש" ח</span>
                    <br />
                }

                <span class="text-bold">
                    @approved.Name
                </span>


            </td>

        </tr>
        <tr class="event-row event-row-@approved.Id.GetNumberFromId()" style="font-size: 1.25em;">
            <td class="tw-6 text-center">
                @if (approved.Day != null)
                {
                    <span>
                        <i class="far fa-fw fa-calendar-alt" data-toggle="tooltip" title="יום האירוע"></i>
                        @approved.Day?.Date.DayOfWeek.InHebrew(),
                        ה-@approved.Day?.Date.ToString("dd/MM", CultureInfo.InvariantCulture)
                        <br />
                    </span>
                }

                @if (approved.TimeSlot != null)
                {
                    <span>
                        <i class="far fa-fw fa-clock" data-toggle="tooltip" title="שעות האירוע"></i>
                        @approved.TimeSlot?.From.ToString("H:mm", CultureInfo.InvariantCulture)
                        -@approved.TimeSlot?.To.ToString("H:mm", CultureInfo.InvariantCulture)
                        <br />
                    </span>
                }

                @if (approved.Hall != null)
                {
                    <span>
                        <i class="fa fa-fw fa-dungeon" data-toggle="tooltip" title="המיקום בכנס"></i> @approved.Hall?.Name - שולחן @approved.HallTable
                        <br />
                    </span>
                }
            </td>
            <td class="tw-6 text-center">
                <i class="fa fa-fw fa-user-circle" data-toggle="tooltip" title="מנחי האירוע"></i>
                @foreach (var host in approved.GameHosts)
                {
                    @host?.FullName
                }
                @if (approved.GameHosts.Any(x => x != null) == false)
                {
                    <span>טרם נקבע</span>
                }
                <br/>
                @{
                    var seatRatio = approved.SeatsAvailable / (double)approved.SeatsCapacity;
                    var seatTitle = "נותרו מקומות פנויים";

                    var seatColor = "text-success";
                    if (seatRatio < 0.3)
                    {
                        seatTitle = "נותרו מקומות אחרונים";
                        seatColor = "text-warning";
                    }
                    if (seatRatio == 0)
                    {
                        seatTitle = "אין מקומות פנויים";
                        seatColor = "text-danger";
                    }
                }
                <i class="fa fa-fw fa-circle @seatColor"
                   data-toggle="tooltip" title="@seatTitle"></i> @approved.SeatsAvailable מקומות פנויים

                <br />
                <i data-toggle="tooltip" title="הגבלת הגיל לאירוע"
                   class="fa fa-fw fa-child"></i> @approved.AgeGroup.GetDescription()
            </td>
        </tr>
        <tr class="bottom-row text-right event-row event-row-@approved.Id.GetNumberFromId()" style="font-size: 1.25em;">
            <td colspan="100%" class="text-right">
                <div class="text-center"
                     data-toggle="collapse" href="#details-@approved.Id.GetNumberFromId()"
                     role="button" aria-expanded="false" aria-controls="details-@approved.Id.GetNumberFromId()">
                    <div class="btn dragon-readmore-btn">
                        <i class="fa fa-fw fa-info-circle"></i> תיאור האירוע
                    </div>
                </div>
                <div class="card card-orange collapse" id="details-@approved.Id.GetNumberFromId()">
                    <strong>@approved.Name: </strong>
                    @approved.Description
                </div>
            </td>
        </tr>
    }

</table>
